<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AR.js dengan A-Frame dan Deteksi Warna Hijau</title>

  <!-- A-Frame Library -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

  <!-- AR.js Library -->
  <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      touch-action: none;
    }

    a-scene {
      width: 100%;
      height: 100%;
    }

    a-camera {
      z-index: 1;
      position: fixed;
      height: 100%;
      width: 100%;
      pointer-events: none;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; markerAreaEnabled: false; debugUIEnabled: true; trackingMethod: best; max-camera-orientation: 0.5;">
    <!-- Kamera untuk AR.js -->
    <a-camera position="0 0 0" fov="80" near="0.1" far="1000" rotation="0 0 0"></a-camera>

    <!-- Marker hijau yang akan muncul saat warna hijau terdeteksi -->
    <a-entity id="modelEntity" visible="false" position="0 0.5 0" scale="0.5 0.5 0.5">
      <a-gltf-model src="Model4.glb"></a-gltf-model>
    </a-entity>
  </a-scene>

  <script>
    const modelEntity = document.getElementById('modelEntity');
    const camera = document.querySelector('a-camera');

    // Canvas untuk deteksi warna hijau
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    let isModelVisible = false;

    // Fungsi untuk mendeteksi warna hijau
    function detectGreen() {
      const video = document.querySelector('video');
      if (!video) return;

      // Menyusun ulang ukuran canvas sesuai dengan ukuran video (kamera)
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Mengambil data piksel dari canvas
      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
      const pixels = imageData.data;

      let greenDetected = false;
      let greenX = 0;
      let greenY = 0;
      let greenCount = 0; // Untuk menghitung jumlah piksel hijau

      // Loop untuk mencari warna hijau (RGB: cukup besar nilai G dan kecil R/B)
      for (let i = 0; i < pixels.length; i += 4) {
        const r = pixels[i];     // Merah
        const g = pixels[i + 1]; // Hijau
        const b = pixels[i + 2]; // Biru

        // Menambahkan log debugging untuk memverifikasi apakah warna hijau terdeteksi
        if (g > 100 && r < 50 && b < 50) {
          // Deteksi warna hijau
          greenDetected = true;
          const x = (i / 4) % canvas.width;
          const y = Math.floor((i / 4) / canvas.width);
          greenX += x;
          greenY += y;
          greenCount++;
        }
      }

      if (greenDetected && greenCount > 100) { // Pastikan cukup banyak piksel hijau terdeteksi
        const avgX = greenX / greenCount;
        const avgY = greenY / greenCount;

        // Menyelaraskan posisi model dengan deteksi posisi hijau
        modelEntity.setAttribute('position', `${avgX / 100} ${avgY / 100} 0`);

        // Menampilkan model saat warna hijau terdeteksi
        if (!isModelVisible) {
          modelEntity.setAttribute('visible', 'true');
          isModelVisible = true;
        }
      } else {
        if (isModelVisible) {
          // Menyembunyikan model jika tidak ada warna hijau
          modelEntity.setAttribute('visible', 'false');
          isModelVisible = false;
        }
      }
    }

    // Menjalankan deteksi warna hijau setiap frame
    function animate() {
      detectGreen();
      requestAnimationFrame(animate);
    }

    animate();
  </script>
</body>
</html>
